[gcode_macro M31]
gcode:
    {% set elapsed = printer.print_stats.total_duration  %}
    {% if elapsed %}
        {% set hours = (elapsed // 3600) %}
        {% set minutes = ((elapsed % 3600) // 60) %}
        {% set seconds = (elapsed % 60) %}
        { action_respond_info("Print Time: %dh %dm %ds" % ( hours, minutes, seconds)) }
    {% else %}
        { action_respond_info("No active print") }
    {% endif %}

[gcode_macro M27]
rename_existing: M27.1
gcode:
    {% if printer.pause_resume.is_paused %}
        { action_respond_info('Print Paused') }
    {% else %}
        M27.1
    {% endif %}

[gcode_macro M117]
rename_existing: M117.1
gcode:
  {% if rawparams %}
    {% set escaped_msg = rawparams.split(';', 1)[0].split('\x23', 1)[0]|replace('"', '\\"') %}
    SET_DISPLAY_TEXT MSG="{escaped_msg}"
    RESPOND TYPE=command MSG="M117: {escaped_msg}"
  {% else %}
    SET_DISPLAY_TEXT
  {% endif %}